---
import {
  fetchCaseStudiesTagsStaticPaths,
  fetchCustomersPage,
} from '@/lib/fetchCMSData';
import { initializeStore } from '@/scripts/store';
import { defaultLocale } from '@/i18n/config';
import {
  createPagesStaticPaths,
  createPaginatedStaticPaths,
} from '@/scripts/utils-static-paths';
import DefaultPage from '@/templates/DefaultPage.astro';
import { customersCaseStudiesStore } from '@/stores/customersCaseStudiesStore';
import { fixPagedParams } from '@/scripts/utils-pagination';

export async function getStaticPaths() {
  const paths = await fetchCaseStudiesTagsStaticPaths();
  const pagesSP = createPagesStaticPaths(paths, {
    paramKey: 'case_studies_tag',
    paramValueType: 'slug',
  });

  return await createPaginatedStaticPaths(pagesSP, {
    postType: 'case-study',
    tagSlug: 'case_studies_tag',
  });
}

const {
  lang = defaultLocale,
  case_studies_tag: tag,
  paged = 1,
} = fixPagedParams(Astro.params);
const data = await fetchCustomersPage(lang, { paged, tag });

initializeStore(customersCaseStudiesStore, {
  isCustomersPage: true,
  lang,
  paged,
  tag,
  data,
});
---

<DefaultPage data={data} />
