---
import { defaultLocale } from '@/i18n/config';
import { getLangParam } from '@/i18n/utils';
import {
  fetchNewsroomListPage,
  fetchNewsroomTagsStaticPaths,
} from '@/lib/fetchCMSData';
import ArticlesList from '@/templates/ArticlesList.astro';

export const getStaticPaths = async () => {
  const finalPaths = [];

  const paths = await fetchNewsroomTagsStaticPaths();
  for (const staticPath of paths) {
    if (!staticPath?.languageCode || !staticPath?.uri || !staticPath?.slug) {
      continue;
    }

    finalPaths.push({
      params: {
        lang: getLangParam(staticPath.languageCode),
        newsroom_tag: staticPath.slug,
      },
    });
  }

  return finalPaths;
};

const { lang = defaultLocale, newsroom_tag: tag } = Astro.params;
const data = await fetchNewsroomListPage(lang, tag);
---

<ArticlesList postType="newsroom" data={data} lang={lang} tag={tag} />
