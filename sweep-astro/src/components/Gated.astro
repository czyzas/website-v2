---
import { fetchHubspotForm } from '@/lib/fetchHubspotForm';
import { cmsStore } from '@/stores/cmsStore';
import { getStore } from '@/scripts/store';
import ClientGated from './Gated';

type Props = {
  formName?: string;
};
const { formName } = Astro.props;
const store = getStore(cmsStore);
const { gatedFormGuid } =
  store.themeOptions?.themeOptionsAcf?.gatedContent ?? {};

const form = gatedFormGuid ? await fetchHubspotForm(gatedFormGuid) : undefined;
---

{
  !!gatedFormGuid && !!form && (
    <ClientGated
      guid={gatedFormGuid}
      form={form}
      formName={formName}
      client:load
    >
      <slot />
    </ClientGated>
  )
}
