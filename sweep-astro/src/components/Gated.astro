---
import type { HTMLAttributes } from 'astro/types';
import type { WithAttributes } from '@/types';
import { fetchHubspotForm } from '@/lib/fetchHubspotForm';
import type { ModulesCollectionFragment } from '@/__generated__/cms';
import ClientGated from './Gated';

interface GatedProps extends HTMLAttributes<'div'> {
  children: ModulesCollectionFragment[];
  hubspotFormGuid?: string;
}

type Props = WithAttributes<GatedProps>;

const { hubspotFormGuid } = Astro.props;
const form = hubspotFormGuid
  ? await fetchHubspotForm(hubspotFormGuid)
  : undefined;
---

{
  !!hubspotFormGuid && !!form && (
    <ClientGated guid={hubspotFormGuid} form={form} client:load>
      <slot />
    </ClientGated>
  )
}
