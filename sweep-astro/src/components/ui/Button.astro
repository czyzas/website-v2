---
import { cva } from 'class-variance-authority';
import type { VariantProps } from 'class-variance-authority';
import type { HTMLAttributes } from 'astro/types';
import { Icon } from 'astro-icon/components';
import { cn } from '@/scripts/cn';
import type { WithAttributes } from '@/types';

type ButtonProps = {
  leadingIcon?: string;
  trailingIcon?: string;
  asLink?: boolean;
};

const buttonVariants = cva(
  [
    'button inline-flex items-center justify-center gap-x-1 rounded-lg text-base font-medium whitespace-nowrap px-3 py-2 border border-transparent transition-colors',
  ],
  {
    variants: {
      variant: {
        primary: [
          'bg-sw-sky-400',
          'text-white',
          'hover:bg-sw-sky-500',
          'shadow-button',
        ],
        secondary: [
          'bg-white',
          'border-sw-border',
          'shadow-button-secondary',
          'text-black',
          'hover:bg-sw-surface-subdued',
        ],
      },
    },
  }
);

type AttributesLink = HTMLAttributes<'a'>;
type AttributesButton = HTMLAttributes<'button'>;
type Attributes = AttributesButton & AttributesLink;

type Props = WithAttributes<
  Attributes & ButtonProps & VariantProps<typeof buttonVariants>
>;

const {
  class: className,
  asLink = false,
  variant = 'primary',
  leadingIcon = '',
  trailingIcon = '',
  ...props
} = Astro.props;

const Tag = asLink ? 'a' : 'button';
---

<Tag {...props} class={cn(buttonVariants({ variant }), className)}>
  {!!leadingIcon && <Icon name={leadingIcon} class="w-[1.125em] h-[1.125em]" />}
  <slot />
  {
    !!trailingIcon && (
      <Icon name={trailingIcon} class="w-[1.125em] h-[1.125em]" />
    )
  }
</Tag>
