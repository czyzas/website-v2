---
import { Image } from 'astro:assets';
import { cmsStore } from '@/stores/cms';
import { getStore } from '@/scripts/store';
import { parseSectionTitle } from '@/scripts/data-parsers/parseSectionTitle';
import { parseImage } from '@/scripts/data-parsers/parseImage';
import Container from '../ui/Container.astro';
import SectionTitle from '../partials/SectionTitle.astro';
import Grid from '../ui/Grid.astro';
import Card from '../ui/Card.astro';

const store = getStore(cmsStore);
const data = store.homepage!;
const acf = data.homepage!.industries!;
const showSelected = (acf?.show ?? 'all') === 'selected';
const allIndustries = store.homepageIndustries?.nodes ?? [];
let industries = allIndustries;

if (showSelected) {
  const filteredIndustries = [];
  for (const industry of acf.selectedIndustries?.nodes ?? []) {
    if (industry.__typename !== 'Industry') continue;

    filteredIndustries.push(industry);
  }

  industries = filteredIndustries;
}
---

<section class="industries bg-sw-surface-subdued py-20">
  <Container>
    <SectionTitle {...parseSectionTitle(acf.sectionTitle)} />

    <Grid>
      {
        industries.length > 0 &&
          industries.map((industry) => {
            const icon = parseImage(industry.industryAcf?.icon);
            return (
              <a href={industry.uri} class="industry col-span-3 group">
                <Card class="py-[2.1875rem] px-[1.375rem] flex flex-col gap-[0.8125rem] transition-colors group-hover:bg-sw-sky-400 hover:border-transparent">
                  {icon.shouldRender && (
                    <Image
                      src={icon.url}
                      alt={icon.alt}
                      width={icon.width}
                      height={icon.height}
                      class="transition-all group-hover:brightness-0 group-hover:invert"
                    />
                  )}
                  <span class="transition-colors typography-h4 group-hover:text-white">
                    {industry.title}
                  </span>
                </Card>
              </a>
            );
          })
      }
    </Grid>
  </Container>
</section>
