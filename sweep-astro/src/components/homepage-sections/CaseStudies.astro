---
import { cmsStore } from '@/stores/cmsStore';
import { getStore } from '@/scripts/store';
import { parseSectionTitle } from '@/scripts/data-parsers/parseSectionTitle';
import { parseLink } from '@/scripts/data-parsers/parseLink';
import type { CaseStudyCardFragment } from '@/__generated__/cms';
import Container from '../ui/Container.astro';
import Button from '../ui/Button.astro';
import SectionTitle from '../partials/SectionTitle.astro';
import ButtonContainer from '../ButtonContainer.astro';
import Section from '../ui/Section.astro';
import CaseStudiesGrid from '../CaseStudiesGrid.astro';

const store = getStore(cmsStore);
const data = store.homepage!;
const acf = data.homepage!.caseStudies!;
const button = parseLink(acf.button);
const cases = acf.caseStudies?.nodes as CaseStudyCardFragment[] | undefined;
---

<Section name="case-studies">
  <Container>
    <SectionTitle
      withMargin
      {...parseSectionTitle(acf.sectionTitle?.selectSectionTitle)}
    />
    <CaseStudiesGrid
      cases={cases ?? []}
      buttonLabel={acf.caseStudyButtonLabel}
    />
    {
      button.shouldRender && (
        <ButtonContainer class="mt-8 md:mt-15">
          <Button
            asLink
            href={button.url}
            target={button.target}
            class="w-full md:w-auto"
          >
            {button.title}
          </Button>
        </ButtonContainer>
      )
    }
  </Container>
</Section>
