---
import { cmsStore } from '@/stores/cmsStore';
import { getStore } from '@/scripts/store';
import { parseSectionTitle } from '@/scripts/data-parsers/parseSectionTitle';
import { parseLink } from '@/scripts/data-parsers/parseLink';
import { cn } from '@/scripts/cn';
import Container from '../ui/Container.astro';
import Grid from '../ui/Grid.astro';
import SectionTitle from '../partials/SectionTitle.astro';
import Prose from '../ui/Prose.astro';
import Card from '../ui/Card.astro';
import Button from '../ui/Button.astro';
import WordpressImage from '../ui/WordpressImage.astro';

const store = getStore(cmsStore);
const data = store.homepage!;
const acf = data.homepage!.whoweworkwith!;

const cards = acf.cards ?? [];
---

<section class="who-we-work-with py-12 md:py-20">
  <Container>
    <SectionTitle {...parseSectionTitle(acf.sectionTitle)} />

    <Grid>
      {
        cards.map((card) => {
          const imageBackgroundColor =
            card?.imageBackgroundColor ?? 'transparent';
          const title = card?.title ?? '';
          const button = parseLink(card?.button);

          return (
            <div class="col-span-full md:col-span-6 lg:col-span-4 flex items-stretch">
              <Card
                class={cn(
                  'card-with-image p-0 flex flex-col overflow-hidden w-full'
                )}
              >
                <div
                  style={{
                    '--bg-color': imageBackgroundColor,
                  }}
                  class="image-container bg-[--bg-color] p-8"
                >
                  <WordpressImage
                    data={card?.image}
                    preferredWidth={400}
                    class="mx-auto w-full max-w-[25rem]"
                  />
                </div>
                <div class="content-container p-6 flex-1 flex flex-col gap-3">
                  <h3 class="typography-h4" set:html={title} />

                  <Prose set:html={card?.content} />

                  {button.shouldRender && (
                    <div class="mt-auto">
                      <Button
                        asLink
                        trailingIcon="arrow-right"
                        href={button.url}
                        target={button.target}
                        class="w-full md:w-auto"
                      >
                        {button.title}
                      </Button>
                    </div>
                  )}
                </div>
              </Card>
            </div>
          );
        })
      }
    </Grid>
  </Container>
</section>
