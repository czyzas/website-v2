---
import { cmsStore } from '@/stores/cmsStore';
import { getStore } from '@/scripts/store';
import { parseSectionTitle } from '@/scripts/data-parsers/parseSectionTitle';
import { parseLink } from '@/scripts/data-parsers/parseLink';
import Container from '../ui/Container.astro';
import Button from '../ui/Button.astro';
import SectionTitle from '../partials/SectionTitle.astro';
import Grid from '../ui/Grid.astro';
import Card from '../ui/Card.astro';
import ButtonContainer from '../ButtonContainer.astro';
import WordpressImage from '../WordpressImage.astro';
import Section from '../ui/Section.astro';

const store = getStore(cmsStore);
const data = store.homepage!;
const acf = data.homepage!.partners!;
const button = parseLink(acf.button);
const partners = acf.partners?.nodes ?? [];
---

<Section name="partners">
  <Container>
    <SectionTitle
      withMargin
      {...parseSectionTitle(acf.sectionTitle?.selectSectionTitle)}
    />
    <Grid>
      {
        partners.map((partner) => {
          if (partner.__typename !== 'Partner') return null;
          return (
            <Card class="col-span-full sm:col-span-6 md:col-span-4 gap-8 flex flex-col items-start">
              <WordpressImage
                data={partner?.partnerAcf?.logo}
                class="h-20 w-48 object-contain object-left"
              />
              <div class="flex flex-col typography-card-title">
                <span>{partner.title}</span>
                <span
                  style={{
                    '--fg': partner.partnerAcf?.categoryColor ?? 'currentColor',
                  }}
                  class="text-[--fg]"
                >
                  {partner.partnerAcf?.category}
                </span>
              </div>
            </Card>
          );
        })
      }
    </Grid>
    {
      button.shouldRender && (
        <ButtonContainer class="mt-8 md:mt-15">
          <Button
            asLink
            href={button.url}
            target={button.target}
            class="w-full md:w-auto"
          >
            {button.title}
          </Button>
        </ButtonContainer>
      )
    }
  </Container>
</Section>
