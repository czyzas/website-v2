---
import ModulesIncluder from '@/components/ModulesIncluder.astro';
import Top from '@/components/partials/Top.astro';
import Layout from '@/layouts/Layout.astro';
import { initializeStore } from '@/scripts/store';
import { cmsStore } from '@/stores/cmsStore';
import { languageStore } from '@/stores/languageStore';
import type {
  DefaultPageQuery,
  IndustrySingleQuery,
} from '@/__generated__/cms';
import type { ColumnSizes, PageTranslations } from '@/types';
import { cleanArray } from '@/scripts/cleanArray';

interface Props {
  data: DefaultPageQuery | IndustrySingleQuery;
}
const { data } = Astro.props;

const page = data.page!;

initializeStore(cmsStore, {
  uri: page.uri,
  primaryMenu: data.primaryMenu!,
  themeOptions: data.themeOptionsByLang!,
  subpageSettings: data.page?.subpageSettings,
});
initializeStore(languageStore, {
  currentLanguage: data.page!.language!,
  languages: data.languages,
  translations: cleanArray(data.page?.translations as PageTranslations),
});

const { subpageSettings } = page;

const pageTitle = page?.title ?? '';
const title = subpageSettings?.customTitle || pageTitle || '';
const content = subpageSettings?.introduction ?? '';
const image = subpageSettings?.image;
const link = subpageSettings?.topButtonLink;
const size = subpageSettings?.topDistribution ?? '5-7';
---

<Layout name="default" pageTitle={pageTitle}>
  <Top
    title={title}
    content={content}
    image={image}
    size={size as ColumnSizes}
    link={link}
    class="py-25"
  />
  <ModulesIncluder data={page?.modules} />
</Layout>
